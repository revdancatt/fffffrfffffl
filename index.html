<!DOCTYPE html>
<html>

<head>
  <title>fffffrfffffl</title>
  <script>
    // DATA from FERAL FILE
    const urlSearchParams = new URLSearchParams(window.location.search)
    const params = Object.fromEntries(urlSearchParams.entries())
    const editionNumber = params.edition_number
    let hash = params.token_id_hash
    if (Object.keys(params).length === 0) {
      // Generates a pure random hash from Nadieh
      hash = '0x'
      for (let i = 64; i > 0; --i) hash += '0123456789abcdef'[~~(Math.random() * 16)]
    }
    class Rand {
      constructor() {
        // PRNG from Piter
        const S = Uint32Array.of(9, 7, 5, 3)
        // eslint-disable-next-line no-return-assign
        this.prng = (a = 1) => a * (a = S[3], S[3] = S[2], S[2] = S[1], a ^= a << 11, S[0] ^= a ^ a >>> 8 ^ (S[1] = S[0]) >>> 19, S[0] / 2 ** 32);
        [...hash + 'ThxPiter'].map(c => this.prng(S[3] ^= c.charCodeAt() * 23205))
      }

      r_d() { // random between 0 and 1
        return this.prng()
      }

      r_n(a, b) { // random float between a and b
        return a + (b - a) * this.r_d()
      }

      r_i(a, b) { // random int between a and b
        return ~~(this.r_n(a, b + 1))
      }

      r_b(p) { // random boolean with probability of p
        return this.r_d() < p
      }

      r_c(list) { // random choice from list
        return list[this.r_i(0, list.length - 1)]
      }
    }
    const R = new Rand()
  </script>
  <script>
    // We need to pick a size, how many sets of data to load in, and which ones to load
    const data = []
    const loadedIds = []
    let thisSize = 24 * 2
    if (R.prng() < 0.05) thisSize = 24 * 3
    const maxImage = 214
    const datasToUse = Math.floor(R.prng() * 3) + 3
    // Loop through the datas and load them in
    while (loadedIds.length < datasToUse) {
      const thisId = `${Math.floor(R.prng() * maxImage).toString().padStart(4, '0')}_${thisSize}.js`
      // Made sure we don't load in the same data twice
      if (!loadedIds.includes(thisId)) {
        loadedIds.push(thisId)
        const script = document.createElement('script')
        script.src = `./data/${thisId}?v=0.1.5`
        document.head.appendChild(script)
      }
    }
  </script>

  <!-- if you need to import js scripts do it here -->
</head>

<body>
  <canvas id="target"></canvas>
  <script src="./makeStory.js?v=0.1.5"></script>
  <script src="./noise.js?v=0.1.5"></script>
  <script src="./index.js?v=0.1.5"></script>
  <script>
    let preloadImagesTmr = null
    document.addEventListener('DOMContentLoaded', (event) => {
      //  stupid hack to make sure we have access to all the images
      preloadImagesTmr = setInterval(() => {
        preloadImages()
      }, 333)
    })
  </script>
</body>

</html>